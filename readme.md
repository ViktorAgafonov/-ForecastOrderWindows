# Оптимальный алгоритм прогнозирования заявок

## Общее описание

Данный алгоритм предназначен для прогнозирования будущих заявок на основе исторических данных о заказах из файла 'Учёт заявок.xlsx'. Алгоритм учитывает частоту заказов, сезонность, сроки поставки и особенности данных для формирования точных прогнозов и рекомендаций по закупкам.

## Структура входных данных

### Файл 'Учёт заявок.xlsx'

- **Дата заявки** - дата создания заявки на товар
- **№ заявки** - уникальный номер заявки
- **№ Поз.** - номер позиции в заявке
- **Наименование товара** - название заказываемого товара (может содержать артикул в тексте)
- **Артикул** - артикул товара (может быть не заполнен)
- **Заказанное количество** - количество заказанного товара
- **Поставленное количество** - количество фактически поставленного товара (может содержать формулы через "+" при частичных поставках)
- **Дата поставки** - дата фактической поставки товара
- **Примечание** - дополнительная информация, может содержать даты частичных поставок

### Особенности данных

- Наименования и артикулы одних и тех же товаров могут отличаться из-за разных поставщиков
- Артикулы могут быть не заполнены в соответствующем поле, а вписаны в наименование товара
- Поставка может быть частичной, с указанием частей через "+" в поле поставленного количества
- Данные могут содержать пропуски и некорректные значения
- Товары могут быть заказаны с разной периодичностью и в разных объемах

## Этапы алгоритма

### 1. Предварительная обработка данных

#### 1.1. Загрузка и очистка данных
- Загрузка данных из файла 'Учёт заявок.xlsx'
- Приведение названий столбцов к единому формату (нижний регистр, без пробелов)
- Удаление пустых строк и столбцов
- Обработка пропущенных значений

#### 1.2. Преобразование типов данных
- Преобразование дат в формат datetime
- Преобразование числовых значений в формат int/float
- Преобразование текстовых данных в формат str
- Обработка формул в поле "Поставленное количество" для расчета фактического количества

#### 1.3. Унификация наименований и артикулов
- Извлечение артикулов из наименований с использованием регулярных выражений, если они не указаны в соответствующем поле
- Нормализация наименований и артикулов с использованием базы соответствий item_mapping.json, которая создается автоматически и может редактироваться пользователем
- Автоматическое обнаружение и группировка товаров по унифицированным артикулам или группам схожих товаров
- Расчет степени схожести наименований с использованием алгоритмов нечеткого сопоставления строк (Levenshtein, Jaro-Winkler, TF-IDF)
- Создание единого справочника товаров с учетом всех возможных вариаций наименований и артикулов от разных поставщиков

### 2. Анализ исторических данных и построение модели потребления

#### 2.1. Построение модели потребления по каждому артикулу
- Формирование временных рядов потребления для каждого унифицированного артикула
- Анализ статистических характеристик потребления (среднее, медиана, дисперсия, квантили)
- Выявление паттернов потребления с использованием методов кластеризации
- Расчет скорости потребления и прогнозирование исчерпания запасов
- Определение критических уровней запаса для каждого артикула с учетом сроков поставки

#### 2.2. Анализ частоты заказов с использованием передовых методов
- Группировка данных по унифицированным артикулам с учетом базы соответствий
- Анализ временных рядов с использованием спектрального анализа и вейвлет-преобразований
- Расчет интервалов между заказами с применением методов сглаживания и фильтрации выбросов
- Применение методов машинного обучения для определения закономерностей в частоте заказов
- Выявление трендов с использованием регрессионного анализа и моделей ARIMA

#### 2.3. Анализ объемов заказов с применением методов анализа больших данных
- Применение методов машинного обучения для прогнозирования оптимальных объемов заказов
- Анализ временных рядов объемов заказов с использованием моделей SARIMA и Prophet
- Применение нейронных сетей (LSTM, GRU) для прогнозирования объемов с учетом сезонности
- Расчет доверительных интервалов для прогнозируемых объемов

#### 2.4. Анализ сезонности с применением разложения временных рядов
- Декомпозиция временных рядов на трендовую, сезонную и остаточную компоненты (STL, X-13-ARIMA-SEATS)
- Анализ сезонных паттернов с использованием спектрального анализа и автокорреляции
- Выявление множественных сезонных паттернов (недельных, месячных, квартальных)
- Расчет динамических коэффициентов сезонности с учетом изменений во времени
- Учет календарных эффектов (праздники, выходные, предпраздничные периоды)

#### 2.5. Анализ сроков поставки с применением вероятностных моделей
- Статистический анализ распределения сроков поставки для каждого артикула и поставщика
- Моделирование сроков поставки с использованием вероятностных распределений
- Анализ факторов, влияющих на сроки поставки (объем заказа, сезон, поставщик)
- Прогнозирование сроков поставки с использованием методов машинного обучения
- Расчет вероятности задержки поставки и оценка рисков

### 3. Формирование прогнозов и рекомендаций с горизонтом планирования до 30 дней

#### 3.1. Прогнозирование дат заказов в краткосрочном периоде
- Формирование календаря заказов на ближайшие 30 дней с учетом:
  - Исторических данных о частоте заказов
  - Текущих запасов и скорости их расходования
  - Прогнозируемого исчерпания критических уровней запаса
- Применение моделей машинного обучения для прогнозирования точных дат заказов в 30-дневном периоде
- Расчет доверительных интервалов для прогнозируемых дат с учетом вероятностных моделей
- Учет внешних факторов, влияющих на даты заказов в краткосрочном периоде

#### 3.2. Прогнозирование оптимальных объемов заказов в 30-дневном горизонте
- Расчет точных объемов заказов для каждого артикула на основе:
  - Прогнозируемого потребления в течение 30-дневного периода
  - Текущих складских запасов и их динамики
  - Оптимальных стратегий пополнения запасов
- Применение моделей оптимизации закупок с учетом:
- Адаптивная корректировка прогнозируемых объемов в реальном времени при появлении новых данных

#### 3.3. Определение оптимальных сроков размещения заказов в краткосрочном периоде
- Расчет конкретных дат размещения заказов в ближайшие 30 дней с учетом:
  - Прогнозируемой даты исчерпания запасов
  - Вероятностных моделей сроков поставки
  - Рисков задержки поставки
- Приоритизация заказов на основе критичности товаров и рисков дефицита
- Группировка заказов по поставщикам для оптимизации логистики и снижения затрат

#### 3.4. Формирование детальных рекомендаций на 30-дневный период
- Создание интерактивного календаря заказов на ближайшие 30 дней с указанием:
  - Конкретных дат размещения заказов
  - Точных объемов заказов для каждого артикула
  - Приоритетности заказов по степени критичности
- Формирование оптимальных групп заказов по поставщикам для минимизации логистических затрат
- Автоматическая генерация заявок на закупку с указанием необходимых артикулов и количеств
- Визуализация прогнозируемого движения запасов в 30-дневном периоде

### 4. Оценка и корректировка прогнозов в реальном времени

#### 4.1. Непрерывная оценка точности прогнозов
- Автоматическое сравнение прогнозируемых и фактических дат и объемов заказов
- Расчет метрик точности прогнозов (MAE, MAPE, RMSE) для каждого артикула
- Выявление систематических отклонений и аномалий в прогнозах
- Оценка экономического эффекта от применения прогнозов

#### 4.2. Адаптивная корректировка моделей в реальном времени
- Автоматическая перенастройка параметров моделей при поступлении новых данных
- Применение методов онлайн-обучения для непрерывного улучшения моделей
- Автоматическое обновление базы соответствий item_mapping.json на основе новых данных
- Динамическая корректировка прогнозов в реальном времени при изменении условий

## Математические модели

### Расчет интервалов между заказами
```
Интервал_i = Дата_заказа_i - Дата_заказа_(i-1)
Средний_интервал = Сумма(Интервал_i) / Количество_интервалов
```

### Расчет коэффициента сезонности
```
Коэффициент_сезонности_месяца = Среднее_количество_в_месяце / Среднее_количество_за_год
```

### Прогноз даты следующего заказа
```
Дата_следующего_заказа = Дата_последнего_заказа + Средний_интервал * Коэффициент_сезонности
```

### Расчет рекомендуемого количества
```
Тренд_изменения = (Последнее_количество - Первое_количество) / (Количество_заказов - 1)
Рекомендуемое_количество = Среднее_количество * (1 + Тренд_изменения) * Коэффициент_сезонности
```

### Оптимальная дата размещения заказа
```
Запас_времени = Максимальный_срок_поставки * 0.2  # 20% запаса на непредвиденные задержки
Дата_размещения = Дата_следующего_заказа - Средний_срок_поставки - Запас_времени
```

## Реализация в системе

Алгоритм реализуется в виде следующих компонентов:

1. **DataProcessor** - обработка и подготовка данных из файла 'Учёт заявок.xlsx'
   - Загрузка и очистка данных
   - Преобразование типов данных
   - Унификация наименований и артикулов

2. **OrderAnalyzer** - анализ исторических данных и выявление паттернов
   - Анализ частоты заказов
   - Анализ сезонности
   - Анализ объемов заказов
   - Анализ сроков поставки

3. **ForecastEngine** - формирование прогнозов на основе результатов анализа
   - Прогнозирование дат заказов
   - Прогнозирование объемов заказов
   - Определение оптимальных сроков размещения заказов

4. **RecommendationSystem** - формирование рекомендаций по заказам
   - Генерация списка товаров для заказа
   - Расчет рекомендуемых объемов
   - Формирование календаря будущих заказов

## Дальнейшие улучшения

- Внедрение методов машинного обучения для повышения точности прогнозов
- Учет дополнительных факторов (праздники, сезонный спрос, рыночные тренды)
- Автоматическая корректировка параметров алгоритма на основе обратной связи
- Интеграция с системами управления запасами и поставками
- Разработка интерактивной визуализации прогнозов и рекомендаций
- Добавление функции оповещений о необходимости размещения заказов
- Учет бюджетных ограничений при формировании рекомендаций
- Оптимизация закупок с учетом минимизации затрат на хранение
